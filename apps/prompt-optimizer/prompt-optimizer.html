<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude 4 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–ãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.5;
            color: #1a202c;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        @media (min-width: 768px) {
            .gradient-bg {
                padding: 2rem;
            }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
        }
        
        .card {
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            padding: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .card {
                padding: 2rem;
            }
        }
        
        .card-title {
            font-size: 1.875rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        @media (min-width: 768px) {
            .card-title {
                font-size: 2.25rem;
            }
        }
        
        .card-subtitle {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 1.5rem;
        }
        
        .grid {
            display: grid;
            gap: 1.5rem;
        }
        
        @media (min-width: 1024px) {
            .grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 768px) {
            .grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .grid-cols-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .textarea {
            width: 100%;
            height: 16rem;
            padding: 1rem;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            resize: none;
            font-family: inherit;
            font-size: 0.875rem;
        }
        
        .textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .textarea:focus {
            outline: none;
            ring: 2px;
            ring-color: rgba(255, 255, 255, 0.5);
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .checkbox-label:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .checkbox {
            width: 1rem;
            height: 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
        }
        
        .btn-primary {
            width: 100%;
            margin-top: 1.5rem;
            background: white;
            color: #764ba2;
            font-weight: bold;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        
        .btn-primary:hover:not(:disabled) {
            opacity: 0.9;
            transform: scale(1.05);
        }
        
        .btn-primary:active:not(:disabled) {
            transform: scale(0.95);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .output-area {
            width: 100%;
            height: 16rem;
            padding: 1rem;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .output-placeholder {
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
            margin-top: 5rem;
        }
        
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 16rem;
        }
        
        .spinner {
            width: 4rem;
            height: 4rem;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            margin-bottom: 1rem;
        }
        
        .loading-text {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .improvement-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 0.75rem;
            color: white;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        .tip-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
            transition: all 0.2s;
        }
        
        .tip-card:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tip-title {
            color: white;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .tip-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
        }
        
        .flex {
            display: flex;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .gap-2 {
            gap: 0.5rem;
        }
        
        .gap-3 {
            gap: 0.75rem;
        }
        
        .mb-3 {
            margin-bottom: 0.75rem;
        }
        
        .mb-4 {
            margin-bottom: 1rem;
        }
        
        .mb-6 {
            margin-bottom: 1.5rem;
        }
        
        .mt-4 {
            margin-top: 1rem;
        }
        
        .mt-6 {
            margin-top: 1.5rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }
        
        svg {
            flex-shrink: 0;
        }
        
        .icon-sm {
            width: 1rem;
            height: 1rem;
        }
        
        .icon-md {
            width: 1.25rem;
            height: 1.25rem;
        }
        
        .icon-lg {
            width: 1.5rem;
            height: 1.5rem;
        }
        
        .icon-xl {
            width: 2.5rem;
            height: 2.5rem;
        }
    </style>
</head>
<body class="gradient-bg">
    <div class="container">
        <div class="glass-effect card mb-6">
            <h1 class="card-title">
                <svg class="icon-xl" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                Claude 4 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–ãƒ„ãƒ¼ãƒ«
            </h1>
            <p class="card-subtitle">Claude 4.xã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã„ã¦ã€ã‚ãªãŸã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æœ€é©åŒ–ã—ã¾ã™</p>
        </div>

        <div class="grid grid-2">
            <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div class="glass-effect card fade-in">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="section-title">
                        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                    </h2>
                </div>
                <textarea 
                    id="originalPrompt" 
                    class="textarea"
                    placeholder="æœ€é©åŒ–ã—ãŸã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...&#10;&#10;ä¾‹ï¼š&#10;ã€ŒAIã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã€&#10;ã€ŒWebã‚µã‚¤ãƒˆã‚’ä½œã£ã¦ã€&#10;ã€Œãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€"
                ></textarea>

                <div class="mt-4">
                    <h3 class="section-title">
                        <svg class="icon-md" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                        </svg>
                        æœ€é©åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³
                    </h3>
                    <div class="grid-cols-2">
                        <label class="checkbox-label">
                            <input type="checkbox" id="opt-clarity" checked class="checkbox">
                            <span>æ˜ç¢ºæ€§å‘ä¸Š</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="opt-context" checked class="checkbox">
                            <span>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ </span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="opt-examples" checked class="checkbox">
                            <span>ä¾‹ã®ææ¡ˆ</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="opt-format" checked class="checkbox">
                            <span>å‡ºåŠ›å½¢å¼æŒ‡å®š</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="opt-action" class="checkbox">
                            <span>è¡Œå‹•æŒ‡å‘</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="opt-parallel" class="checkbox">
                            <span>ä¸¦åˆ—å‡¦ç†æœ€é©åŒ–</span>
                        </label>
                    </div>
                </div>

                <button 
                    id="optimizeBtn" 
                    class="btn-primary"
                >
                    <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æœ€é©åŒ–
                </button>
            </div>

            <!-- å‡ºåŠ›ã‚¨ãƒªã‚¢ -->
            <div class="glass-effect card fade-in">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="section-title">
                        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        æœ€é©åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                    </h2>
                    <button 
                        id="copyBtn" 
                        class="btn-secondary hidden"
                    >
                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                        ã‚³ãƒ”ãƒ¼
                    </button>
                </div>
                
                <div id="loadingState" class="loading-container hidden">
                    <div class="spinner animate-spin"></div>
                    <p class="loading-text">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æœ€é©åŒ–ä¸­...</p>
                </div>

                <div id="outputArea" class="output-area">
                    <p class="output-placeholder">
                        æœ€é©åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                    </p>
                </div>

                <div id="improvementsSection" class="mt-4 hidden">
                    <h3 class="section-title">
                        <svg class="icon-md" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        é©ç”¨ã•ã‚ŒãŸæ”¹å–„ç‚¹
                    </h3>
                    <div id="improvementsList"></div>
                </div>
            </div>
        </div>

        <!-- ãƒ’ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="glass-effect card mt-6 fade-in">
            <h3 class="section-title mb-4">
                <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
                Claude 4 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
            </h3>
            <div class="grid grid-3">
                <div class="tip-card">
                    <div class="tip-title">âœ¨ æ˜ç¢ºã§å…·ä½“çš„ã«</div>
                    <p class="tip-text">æœ›ã¾ã—ã„å‡ºåŠ›ã«ã¤ã„ã¦å…·ä½“çš„ã«è¨˜è¿°ã—ã€æ˜ç¤ºçš„ãªæŒ‡ç¤ºã‚’æä¾›ã—ã¾ã™ã€‚</p>
                </div>
                <div class="tip-card">
                    <div class="tip-title">ğŸ¯ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ </div>
                    <p class="tip-text">æŒ‡ç¤ºã®èƒŒæ™¯ã‚„å‹•æ©Ÿã‚’èª¬æ˜ã—ã€ClaudeãŒç›®æ¨™ã‚’ç†è§£ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p>
                </div>
                <div class="tip-card">
                    <div class="tip-title">ğŸ“ ä¾‹ã‚’æä¾›</div>
                    <p class="tip-text">æœ›ã¾ã—ã„å‹•ä½œã¨ä¸€è‡´ã™ã‚‹å…·ä½“çš„ãªä¾‹ã‚’å«ã‚ã¾ã™ã€‚</p>
                </div>
                <div class="tip-card">
                    <div class="tip-title">ğŸ¨ å½¢å¼ã‚’æŒ‡å®š</div>
                    <p class="tip-text">å‡ºåŠ›å½¢å¼ã‚’XMLã‚¿ã‚°ã‚„ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã§æ˜ç¢ºã«æŒ‡å®šã—ã¾ã™ã€‚</p>
                </div>
                <div class="tip-card">
                    <div class="tip-title">âš¡ è¡Œå‹•æŒ‡å‘ã«</div>
                    <p class="tip-text">ææ¡ˆã™ã‚‹ã ã‘ã§ãªãã€å®Ÿè£…ã™ã‚‹ã‚ˆã†æ˜ç¤ºçš„ã«æŒ‡ç¤ºã—ã¾ã™ã€‚</p>
                </div>
                <div class="tip-card">
                    <div class="tip-title">ğŸ”„ æ®µéšçš„ã«</div>
                    <p class="tip-text">è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã¯æ®µéšçš„ãªé€²æ—ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const optimizeBtn = document.getElementById('optimizeBtn');
        const originalPrompt = document.getElementById('originalPrompt');
        const outputArea = document.getElementById('outputArea');
        const loadingState = document.getElementById('loadingState');
        const copyBtn = document.getElementById('copyBtn');
        const improvementsSection = document.getElementById('improvementsSection');
        const improvementsList = document.getElementById('improvementsList');

        let optimizedPromptText = '';

        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(optimizedPromptText).then(() => {
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = `
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
                `;
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                }, 2000);
            });
        });

        optimizeBtn.addEventListener('click', async () => {
            const prompt = originalPrompt.value.trim();
            if (!prompt) {
                alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const options = {
                clarity: document.getElementById('opt-clarity').checked,
                context: document.getElementById('opt-context').checked,
                examples: document.getElementById('opt-examples').checked,
                format: document.getElementById('opt-format').checked,
                action: document.getElementById('opt-action').checked,
                parallel: document.getElementById('opt-parallel').checked
            };

            optimizeBtn.disabled = true;
            optimizeBtn.innerHTML = `
                <svg class="icon-lg animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                æœ€é©åŒ–ä¸­...
            `;
            outputArea.classList.add('hidden');
            loadingState.classList.remove('hidden');
            copyBtn.classList.add('hidden');
            improvementsSection.classList.add('hidden');

            try {
                const systemPrompt = buildSystemPrompt(options);
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 4000,
                        messages: [
                            {
                                role: "user",
                                content: `ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’Claude 4ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã„ã¦æœ€é©åŒ–ã—ã¦ãã ã•ã„ã€‚

å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:
${prompt}

æœ€é©åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
${JSON.stringify(options, null, 2)}

æœ€é©åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’<optimized_prompt>ã‚¿ã‚°å†…ã«å‡ºåŠ›ã—ã€é©ç”¨ã—ãŸæ”¹å–„ç‚¹ã‚’<improvements>ã‚¿ã‚°å†…ã«ç®‡æ¡æ›¸ãã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`
                            }
                        ],
                        system: systemPrompt
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                const responseText = data.content[0].text;

                const optimizedMatch = responseText.match(/<optimized_prompt>([\s\S]*?)<\/optimized_prompt>/);
                const improvementsMatch = responseText.match(/<improvements>([\s\S]*?)<\/improvements>/);

                if (optimizedMatch) {
                    optimizedPromptText = optimizedMatch[1].trim();
                    outputArea.innerHTML = `<pre class="whitespace-pre-wrap font-mono text-sm">${escapeHtml(optimizedPromptText)}</pre>`;
                    copyBtn.classList.remove('hidden');
                } else {
                    outputArea.innerHTML = `<pre class="whitespace-pre-wrap font-mono text-sm">${escapeHtml(responseText)}</pre>`;
                    optimizedPromptText = responseText;
                    copyBtn.classList.remove('hidden');
                }

                if (improvementsMatch) {
                    const improvements = improvementsMatch[1].trim().split('\n').filter(line => line.trim());
                    improvementsList.innerHTML = improvements.map(improvement => `
                        <div class="improvement-item">
                            ${escapeHtml(improvement.replace(/^[-â€¢*]\s*/, ''))}
                        </div>
                    `).join('');
                    improvementsSection.classList.remove('hidden');
                }

            } catch (error) {
                console.error('Error:', error);
                outputArea.innerHTML = `<p style="color: #fca5a5;">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${escapeHtml(error.message)}</p>`;
            } finally {
                loadingState.classList.add('hidden');
                outputArea.classList.remove('hidden');
                optimizeBtn.disabled = false;
                optimizeBtn.innerHTML = `
                    <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æœ€é©åŒ–
                `;
            }
        });

        function buildSystemPrompt(options) {
            let prompt = `ã‚ãªãŸã¯Claude 4ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®å°‚é–€å®¶ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æä¾›ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã€Claude 4.xãƒ¢ãƒ‡ãƒ«ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã„ã¦æœ€é©åŒ–ã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸‹ã®åŸå‰‡ã«å¾“ã£ã¦ãã ã•ã„:

1. æŒ‡ç¤ºã‚’æ˜ç¢ºã«ã™ã‚‹: æ›–æ˜§ã•ã‚’æ’é™¤ã—ã€å…·ä½“çš„ã§æ˜ç¤ºçš„ãªæŒ‡ç¤ºã‚’æä¾›ã—ã¾ã™ã€‚
2. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹: ãªãœãã®å‹•ä½œãŒé‡è¦ãªã®ã‹ã€èƒŒæ™¯ã‚’èª¬æ˜ã—ã¾ã™ã€‚
3. ä¾‹ã¨è©³ç´°ã«æ³¨æ„ã‚’æ‰•ã†: é©åˆ‡ãªä¾‹ã‚’æä¾›ã—ã€è©³ç´°ã‚’æ˜ç¢ºã«ã—ã¾ã™ã€‚`;

            if (options.clarity) {
                prompt += `\n\næ˜ç¢ºæ€§å‘ä¸Š:
- æ›–æ˜§ãªè¡¨ç¾ã‚’å…·ä½“çš„ãªæŒ‡ç¤ºã«ç½®ãæ›ãˆã‚‹
- æœ›ã¾ã—ã„å‡ºåŠ›ã«ã¤ã„ã¦è©³ç´°ã«è¨˜è¿°ã™ã‚‹
- ã€Œä½•ã‚’ã—ãªã„ã‹ã€ã§ã¯ãªãã€Œä½•ã‚’ã™ã‚‹ã‹ã€ã‚’æŒ‡ç¤ºã™ã‚‹`;
            }

            if (options.context) {
                prompt += `\n\nã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ :
- ã‚¿ã‚¹ã‚¯ã®ç›®çš„ã‚„èƒŒæ™¯ã‚’èª¬æ˜ã™ã‚‹
- ãªãœãã®å‹•ä½œãŒé‡è¦ãªã®ã‹ã‚’æ˜ç¤ºã™ã‚‹
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã‚„ä½¿ç”¨ç›®çš„ã‚’å«ã‚ã‚‹`;
            }

            if (options.examples) {
                prompt += `\n\nä¾‹ã®ææ¡ˆ:
- æœ›ã¾ã—ã„å‡ºåŠ›ã®å…·ä½“ä¾‹ã‚’1-2å€‹æä¾›ã™ã‚‹
- ä¾‹ã¯å¤šæ§˜ã§ä»£è¡¨çš„ãªã‚‚ã®ã«ã™ã‚‹
- ãƒã‚¸ãƒ†ã‚£ãƒ–ãªä¾‹ã ã‘ã§ãªãã€é¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ç¤ºã™`;
            }

            if (options.format) {
                prompt += `\n\nå‡ºåŠ›å½¢å¼æŒ‡å®š:
- XMLã‚¿ã‚°ã‚’ä½¿ç”¨ã—ã¦å‡ºåŠ›æ§‹é€ ã‚’æ˜ç¢ºã«ã™ã‚‹
- ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ä½¿ç”¨ãƒ«ãƒ¼ãƒ«ã‚’æŒ‡å®šã™ã‚‹ï¼ˆæ®µè½ã§æ›¸ãã€ç®‡æ¡æ›¸ãã¯æœ€å°é™ãªã©ï¼‰
- æœŸå¾…ã™ã‚‹å¿œç­”ã®é•·ã•ã‚„è©³ç´°ãƒ¬ãƒ™ãƒ«ã‚’æŒ‡å®šã™ã‚‹`;
            }

            if (options.action) {
                prompt += `\n\nè¡Œå‹•æŒ‡å‘:
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–ã‚‹ã‚ˆã†æŒ‡ç¤ºã™ã‚‹
- ææ¡ˆã ã‘ã§ãªãå®Ÿè£…ã‚’æ±‚ã‚ã‚‹
- ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ã‚’ç©æ¥µçš„ã«è¡Œã†ã‚ˆã†ä¿ƒã™`;
            }

            if (options.parallel) {
                prompt += `\n\nä¸¦åˆ—å‡¦ç†æœ€é©åŒ–:
- ç‹¬ç«‹ã—ãŸã‚¿ã‚¹ã‚¯ã¯ä¸¦åˆ—ã§å®Ÿè¡Œã™ã‚‹ã‚ˆã†æŒ‡ç¤ºã™ã‚‹
- è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šã‚„ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’åŒæ™‚ã«è¡Œã†ã‚ˆã†ä¿ƒã™`;
            }

            prompt += `\n\nå‡ºåŠ›å½¢å¼:
<optimized_prompt>
[æœ€é©åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã“ã“ã«è¨˜è¿°]
</optimized_prompt>

<improvements>
- [é©ç”¨ã—ãŸæ”¹å–„ç‚¹1]
- [é©ç”¨ã—ãŸæ”¹å–„ç‚¹2]
- [é©ç”¨ã—ãŸæ”¹å–„ç‚¹3]
...
</improvements>

é‡è¦: å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ„å›³ã‚’ç¶­æŒã—ãªãŒã‚‰ã€Claude 4.xãƒ¢ãƒ‡ãƒ«ã§ã‚ˆã‚Šè‰¯ã„çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«æ”¹å–„ã—ã¦ãã ã•ã„ã€‚`;

            return prompt;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>