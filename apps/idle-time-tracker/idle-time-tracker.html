<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½•ã‚‚ã—ã¦ã„ãªã„æ™‚é–“ãƒˆãƒ©ãƒƒã‚«ãƒ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .date-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .date-selector button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        .date-selector button:hover {
            background: #5568d3;
        }

        .date-selector .current-date {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .calendar-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .time-grid {
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .time-row {
            display: grid;
            grid-template-columns: 80px 1fr;
            border-bottom: 1px solid #f0f0f0;
        }

        .time-row:last-child {
            border-bottom: none;
        }

        .time-label {
            padding: 15px;
            text-align: center;
            font-size: 0.9em;
            color: #666;
            border-right: 2px solid #e0e0e0;
            background: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .time-slot {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            user-select: none;
            display: flex;
            align-items: center;
        }

        .time-slot:hover {
            background: #f0f0ff;
        }

        .time-slot.selected {
            background: linear-gradient(135deg, #a8b5ff 0%, #c4b5fd 100%);
            color: white;
        }

        .time-slot.idle {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            font-weight: bold;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
        }

        .analysis-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .analysis-container h2 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            line-height: 1.8;
            color: #555;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-style: italic;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .visualization {
            margin-top: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            gap: 10px;
            margin-top: 20px;
        }

        .bar {
            flex: 1;
            background: linear-gradient(to top, #667eea 0%, #764ba2 100%);
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: all 0.3s;
            min-height: 20px;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar-label {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .emoji {
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ™ ä½•ã‚‚ã—ã¦ã„ãªã„æ™‚é–“ãƒˆãƒ©ãƒƒã‚«ãƒ¼</h1>
            <p>ã‚ãªãŸã®ã€Œç„¡ã€ã®æ™‚é–“ã‚’è¨˜éŒ²ãƒ»åˆ†æãƒ»è©•ä¾¡ã—ã¾ã™</p>
        </div>

        <div class="content">
            <div class="date-selector">
                <button onclick="changeDate(-1)">â—€ å‰æ—¥</button>
                <div class="current-date" id="currentDate"></div>
                <button onclick="changeDate(1)">æ¬¡æ—¥ â–¶</button>
            </div>

            <div class="calendar-container">
                <h2 style="margin-bottom: 15px; color: #333;">ğŸ“… æ™‚é–“é¸æŠï¼ˆãƒ‰ãƒ©ãƒƒã‚°ã§ç¯„å›²æŒ‡å®šï¼‰</h2>
                <div class="time-grid" id="timeGrid"></div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveIdleTime()">ğŸ’¾ ä½•ã‚‚ã—ã¦ã„ãªã„æ™‚é–“ã¨ã—ã¦ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="clearSelection()">ğŸ”„ é¸æŠã‚’ã‚¯ãƒªã‚¢</button>
                <button class="btn btn-primary" onclick="analyzeIdleTime()">ğŸ¤– AIã§åˆ†æã™ã‚‹</button>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <h3>ä»Šæ—¥ã®ä½•ã‚‚ã—ã¦ã„ãªã„æ™‚é–“</h3>
                    <div class="value" id="todayIdle">0h</div>
                </div>
                <div class="stat-card">
                    <h3>ä»Šé€±ã®åˆè¨ˆ</h3>
                    <div class="value" id="weekIdle">0h</div>
                </div>
                <div class="stat-card">
                    <h3>ä½•ã‚‚ã—ã¦ã„ãªã„å‰²åˆ</h3>
                    <div class="value" id="idlePercentage">0%</div>
                </div>
            </div>

            <div class="visualization">
                <h2 style="color: #333; margin-bottom: 10px;">ğŸ“Š é€±é–“ãƒˆãƒ¬ãƒ³ãƒ‰</h2>
                <div class="bar-chart" id="barChart"></div>
            </div>

            <div class="analysis-container" id="analysisContainer" style="display: none;">
                <h2><span class="emoji">ğŸ¤–</span> AIåˆ†æçµæœ</h2>
                <div class="analysis-content" id="analysisContent"></div>
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let selectedSlots = new Set();
        let isDragging = false;
        let idleTimeData = JSON.parse(localStorage.getItem('idleTimeData') || '{}');

        function initCalendar() {
            const grid = document.getElementById('timeGrid');
            grid.innerHTML = '';
            
            for (let hour = 0; hour < 24; hour++) {
                const row = document.createElement('div');
                row.className = 'time-row';

                const label = document.createElement('div');
                label.className = 'time-label';
                label.textContent = `${hour.toString().padStart(2, '0')}:00`;

                const slot = document.createElement('div');
                slot.className = 'time-slot';
                slot.dataset.hour = hour;
                slot.textContent = `${hour}:00 - ${(hour + 1).toString().padStart(2, '0')}:00`;

                const dateKey = getDateKey(currentDate);
                if (idleTimeData[dateKey] && idleTimeData[dateKey].includes(hour)) {
                    slot.classList.add('idle');
                }

                slot.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    toggleSlot(slot);
                });

                slot.addEventListener('mouseenter', (e) => {
                    if (isDragging) {
                        toggleSlot(slot);
                    }
                });

                slot.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                row.appendChild(label);
                row.appendChild(slot);
                grid.appendChild(row);
            }

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            updateDateDisplay();
            updateStats();
            updateVisualization();
        }

        function toggleSlot(slot) {
            if (slot.classList.contains('idle')) return;
            
            const hour = parseInt(slot.dataset.hour);
            if (selectedSlots.has(hour)) {
                selectedSlots.delete(hour);
                slot.classList.remove('selected');
            } else {
                selectedSlots.add(hour);
                slot.classList.add('selected');
            }
        }

        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function saveIdleTime() {
            if (selectedSlots.size === 0) {
                alert('æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const dateKey = getDateKey(currentDate);
            if (!idleTimeData[dateKey]) {
                idleTimeData[dateKey] = [];
            }

            selectedSlots.forEach(hour => {
                if (!idleTimeData[dateKey].includes(hour)) {
                    idleTimeData[dateKey].push(hour);
                }
            });

            localStorage.setItem('idleTimeData', JSON.stringify(idleTimeData));
            selectedSlots.clear();
            initCalendar();
            alert('ä¿å­˜ã—ã¾ã—ãŸï¼âœ¨');
        }

        function clearSelection() {
            selectedSlots.clear();
            initCalendar();
        }

        function changeDate(days) {
            currentDate.setDate(currentDate.getDate() + days);
            selectedSlots.clear();
            initCalendar();
        }

        function updateDateDisplay() {
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('currentDate').textContent = 
                currentDate.toLocaleDateString('ja-JP', options);
        }

        function updateStats() {
            const dateKey = getDateKey(currentDate);
            const todayHours = idleTimeData[dateKey]?.length || 0;
            
            let weekHours = 0;
            for (let i = 0; i < 7; i++) {
                const date = new Date(currentDate);
                date.setDate(date.getDate() - i);
                const key = getDateKey(date);
                weekHours += idleTimeData[key]?.length || 0;
            }

            const percentage = Math.round((todayHours / 24) * 100);

            document.getElementById('todayIdle').textContent = `${todayHours}æ™‚é–“`;
            document.getElementById('weekIdle').textContent = `${weekHours}æ™‚é–“`;
            document.getElementById('idlePercentage').textContent = `${percentage}%`;
        }

        function updateVisualization() {
            const chart = document.getElementById('barChart');
            chart.innerHTML = '';

            const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(currentDate);
                date.setDate(date.getDate() - i);
                const key = getDateKey(date);
                const hours = idleTimeData[key]?.length || 0;
                const height = (hours / 24) * 100;

                const barContainer = document.createElement('div');
                barContainer.style.flex = '1';
                barContainer.style.display = 'flex';
                barContainer.style.flexDirection = 'column';
                barContainer.style.alignItems = 'center';

                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = `${height}%`;
                bar.title = `${hours}æ™‚é–“`;

                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = days[date.getDay()];

                barContainer.appendChild(bar);
                barContainer.appendChild(label);
                chart.appendChild(barContainer);
            }
        }

        async function analyzeIdleTime() {
            const analysisContainer = document.getElementById('analysisContainer');
            const analysisContent = document.getElementById('analysisContent');
            
            analysisContainer.style.display = 'block';
            analysisContent.innerHTML = '<div class="loading">ğŸ¤– AIãŒåˆ†æä¸­...</div>';

            let totalHours = 0;
            const weekData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(currentDate);
                date.setDate(date.getDate() - i);
                const key = getDateKey(date);
                const hours = idleTimeData[key]?.length || 0;
                totalHours += hours;
                weekData.push({ date: key, hours });
            }

            const prompt = `ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œä½•ã‚‚ã—ã¦ã„ãªã„æ™‚é–“ã€ã®è¨˜éŒ²ã§ã™ã€‚

éå»7æ—¥é–“ã®ãƒ‡ãƒ¼ã‚¿:
${weekData.map(d => `${d.date}: ${d.hours}æ™‚é–“`).join('\n')}

åˆè¨ˆ: ${totalHours}æ™‚é–“ (7æ—¥é–“)

ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰è©•ä¾¡ã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã—ã¦ãã ã•ã„:
1. ä½•ã‚‚ã—ã¦ã„ãªã„æ™‚é–“ã®å‚¾å‘ï¼ˆå¤šã„/å°‘ãªã„/é©åˆ‡ï¼‰
2. ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ†æï¼ˆæ›œæ—¥ã«ã‚ˆã‚‹é•ã„ãªã©ï¼‰
3. ã“ã®æ™‚é–“ã®æ„ç¾©ã‚„ä¾¡å€¤
4. ä»Šå¾Œã®ãƒãƒ©ãƒ³ã‚¹ã«é–¢ã™ã‚‹å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹

æ¸©ã‹ãã€å‰å‘ãã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åŠ±ã¾ã™ãƒˆãƒ¼ãƒ³ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚æ—¥æœ¬èªã§400æ–‡å­—ç¨‹åº¦ã§ã€‚`;

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [
                            { role: 'user', content: prompt }
                        ]
                    })
                });

                const data = await response.json();
                const analysis = data.content[0].text;
                
                analysisContent.innerHTML = `
                    <p>${analysis.replace(/\n/g, '<br><br>')}</p>
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0; color: #888; font-size: 0.9em;">
                        <strong>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼:</strong> 
                        éå»7æ—¥é–“ã§åˆè¨ˆ${totalHours}æ™‚é–“ï¼ˆ1æ—¥å¹³å‡${(totalHours/7).toFixed(1)}æ™‚é–“ï¼‰ã®ã€Œä½•ã‚‚ã—ã¦ã„ãªã„æ™‚é–“ã€ã‚’è¨˜éŒ²ã—ã¾ã—ãŸã€‚
                    </div>
                `;
            } catch (error) {
                analysisContent.innerHTML = `
                    <p style="color: #e53e3e;">åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        ãŸã ã—ã€ã‚ãªãŸã®è¨˜éŒ²ã¯ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ï¼ä½•ã‚‚ã—ã¦ã„ãªã„æ™‚é–“ã¯ã€
                        å¿ƒã¨ä½“ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹å¤§åˆ‡ãªæ™‚é–“ã§ã™ã€‚ã“ã®æ™‚é–“ãŒã‚ã‚‹ã“ã¨ã§ã€
                        æ¬¡ã®æ´»å‹•ã«ã‚ˆã‚Šé›†ä¸­ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚âœ¨
                    </p>
                `;
            }
        }

        initCalendar();
    </script>
</body>
</html>